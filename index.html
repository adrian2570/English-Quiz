<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Mobile Vocab Quiz</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 15px;
      background: #f8f9fa;
      color: #333;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    h1 {
      color: #1a73e8;
      text-align: center;
      margin: 20px 0;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin: 20px 0;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
      box-sizing: border-box;
    }
    button {
      background: #1a73e8;
      color: white;
      border: none;
      font-weight: 500;
    }
    #progress {
      height: 4px;
      background: #e9ecef;
      border-radius: 2px;
      margin: 15px 0;
    }
    #progressBar {
      height: 100%;
      background: #1a73e8;
      width: 0%;
      transition: width 0.3s ease;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“± Vocab Quiz</h1>
    
    <!-- Quiz Section -->
    <div class="card">
      <div id="progress"><div id="progressBar"></div></div>
      <p id="sentence" style="font-size:1.2em; margin:15px 0"></p>
      <input type="text" id="answer" placeholder="Type missing word..." autocapitalize="none">
      <div id="message" style="margin:10px 0"></div>
    </div>

    <!-- Add New Word -->
    <div class="card">
      <h3 style="margin-top:0">âž• Add New</h3>
      <input type="text" id="newSentence" placeholder="Full sentence">
      <input type="text" id="hiddenWord" placeholder="Word to hide">
      <button onclick="addWord()">Save Word</button>
    </div>
  </div>

<script>
// Data Storage
let words = JSON.parse(localStorage.getItem('vocab')) || [
  {
    sentence: "The ____ is shining brightly.",
    full: "The sun is shining brightly.",
    word: "sun"
  }
];
let currentIndex = 0;
let synth = window.speechSynthesis;
let googleVoice = null;

// Voice Setup
async function setupVoices() {
  const voices = await new Promise(resolve => {
    synth.onvoiceschanged = () => resolve(synth.getVoices());
    if (synth.getVoices().length) resolve(synth.getVoices());
  });
  
  // Find Google US English female voice
  googleVoice = voices.find(v => 
    v.voiceURI.includes('Google') && 
    v.lang === 'en-US' &&
    v.name.toLowerCase().includes('female')
  ) || voices[0];
}

// Quiz Functions
function updateProgress() {
  const progress = (currentIndex / words.length) * 100;
  document.getElementById('progressBar').style.width = `${progress}%`;
}

function showNextWord() {
  if(currentIndex >= words.length) {
    document.getElementById('sentence').textContent = "All done! ðŸŽ‰";
    return;
  }
  
  const current = words[currentIndex];
  document.getElementById('sentence').textContent = current.sentence;
  speak(current.full);
  document.getElementById('answer').value = '';
  updateProgress();
}

function speak(text) {
  if(!synth || !googleVoice) return;
  
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.voice = googleVoice;
  utterance.rate = 1.0;
  synth.cancel();
  synth.speak(utterance);
}

// Word Management
function addWord() {
  const sentence = document.getElementById('newSentence').value.trim();
  const word = document.getElementById('hiddenWord').value.trim();
  
  if(!sentence || !word) return;
  
  words.push({
    sentence: sentence.replace(new RegExp(word, 'gi'), '____'),
    full: sentence,
    word: word.toLowerCase()
  });
  
  localStorage.setItem('vocab', JSON.stringify(words));
  document.getElementById('newSentence').value = '';
  document.getElementById('hiddenWord').value = '';
  showNextWord();
}

// Answer Check
document.getElementById('answer').addEventListener('keypress', e => {
  if(e.key !== 'Enter') return;
  
  const answer = e.target.value.trim().toLowerCase();
  const correct = words[currentIndex]?.word.toLowerCase();
  
  if(answer === correct) {
    document.getElementById('message').textContent = "âœ… Correct!";
    currentIndex++;
    setTimeout(showNextWord, 1000);
  } else {
    document.getElementById('message').textContent = "âŒ Try again!";
    speak(words[currentIndex].full);
  }
});

// Initialize
window.onload = async () => {
  await setupVoices();
  showNextWord();
};
</script>
</body>
</html>
